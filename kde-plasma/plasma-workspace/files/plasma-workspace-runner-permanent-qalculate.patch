diff -Naur plasma-workspace-5.21.4-orig/CMakeLists.txt plasma-workspace-5.21.4/CMakeLists.txt
--- plasma-workspace-5.21.4-orig/CMakeLists.txt	2021-04-06 05:40:25.000000000 -0700
+++ plasma-workspace-5.21.4/CMakeLists.txt	2021-04-19 00:45:34.723355834 -0700
@@ -73,6 +73,13 @@
                        PURPOSE "Needed for the File Search runner."
                       )
 
+find_package(Qalculate)
+set_package_properties(Qalculate PROPERTIES DESCRIPTION "Qalculate Library"
+                       URL "https://qalculate.github.io/"
+                       TYPE OPTIONAL
+                       PURPOSE "Needed to enable advanced features of the calculator runner"
+                      )
+
 find_package(KF5TextEditor)
 find_package(KWinDBusInterface CONFIG REQUIRED)
 
diff -Naur plasma-workspace-5.21.4-orig/runners/calculator/CMakeLists.txt plasma-workspace-5.21.4/runners/calculator/CMakeLists.txt
--- plasma-workspace-5.21.4-orig/runners/calculator/CMakeLists.txt	2021-04-06 05:39:01.000000000 -0700
+++ plasma-workspace-5.21.4/runners/calculator/CMakeLists.txt	2021-04-19 01:13:39.156444037 -0700
@@ -2,49 +2,34 @@
 ########### next target ###############
 
 add_definitions(-DTRANSLATION_DOMAIN=\"plasma_runner_calculatorrunner\")
+add_definitions(-DENABLE_QALCULATE)
 
-find_package(Qalculate)
-set_package_properties(Qalculate PROPERTIES DESCRIPTION "Qalculate Library"
-                       URL "https://qalculate.github.io/"
-                       TYPE OPTIONAL
-                       PURPOSE "Needed to enable advanced features of the calculator runner"
-                      )
-if ( QALCULATE_FOUND )
-    add_definitions(-DENABLE_QALCULATE)
-
-    set(qalculate_engine_SRCS
-    qalculate_engine.cpp
-    )
-
-    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wno-deprecated")
-    kde_enable_exceptions()
-endif()
+set(EXTERNAL_LIBS
+    KF5::KIOCore
+    KF5::Runner
+    KF5::I18n
+    Qt5::Network
+    Qt5::Widgets
+)
 
 set(krunner_calculatorrunner_SRCS
     calculatorrunner.cpp
 )
 
-if ( QALCULATE_FOUND )
-    add_library(krunner_calculatorrunner MODULE ${qalculate_engine_SRCS} ${krunner_calculatorrunner_SRCS})
-    kcoreaddons_desktop_to_json(krunner_calculatorrunner plasma-runner-calculator.desktop )
-    target_link_libraries(krunner_calculatorrunner
-                          ${QALCULATE_LIBRARIES}
-                          ${CLN_LIBRARIES}
-                          KF5::KIOCore
-                          KF5::Runner
-                          KF5::I18n
-                          Qt5::Network
-                          Qt5::Widgets
-    )
-else ()
-    add_library(krunner_calculatorrunner MODULE ${krunner_calculatorrunner_SRCS})
-    kcoreaddons_desktop_to_json(krunner_calculatorrunner plasma-runner-calculator.desktop )
-    target_link_libraries(krunner_calculatorrunner
-                          KF5::Runner
-                          KF5::I18n
-                          Qt5::Gui
-                          Qt5::Qml
-    )
-endif ()
+set(qalculate_engine_SRCS
+    qalculate_engine.cpp
+)
+
+set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wno-deprecated")
+kde_enable_exceptions()
+
+add_library(krunner_calculatorrunner MODULE ${qalculate_engine_SRCS} ${krunner_calculatorrunner_SRCS})
+kcoreaddons_desktop_to_json(krunner_calculatorrunner plasma-runner-calculator.desktop )
+
+target_link_libraries(krunner_calculatorrunner
+                      ${QALCULATE_LIBRARIES}
+                      ${CLN_LIBRARIES}
+                      ${EXTERNAL_LIBS}
+)
 
 install(TARGETS krunner_calculatorrunner DESTINATION "${KDE_INSTALL_PLUGINDIR}/kf5/krunner" )
diff -Naur plasma-workspace-5.21.4-orig/runners/CMakeLists.txt plasma-workspace-5.21.4/runners/CMakeLists.txt
--- plasma-workspace-5.21.4-orig/runners/CMakeLists.txt	2021-04-06 05:39:01.000000000 -0700
+++ plasma-workspace-5.21.4/runners/CMakeLists.txt	2021-04-19 00:46:12.474982795 -0700
@@ -3,7 +3,9 @@
  add_subdirectory(baloo)
 endif()
 add_subdirectory(bookmarks)
-add_subdirectory(calculator)
+if(QALCULATE_FOUND)
+ add_subdirectory(calculator)
+endif()
 add_subdirectory(locations)
 add_subdirectory(places)
 add_subdirectory(services)
